!function(){"use strict";function e(e,t){return"string"==typeof e?(t||document).querySelector(e):null}function t(e,t){return[].slice.call((t||document).querySelectorAll(e))}function n(e,t){"object"==typeof e&&e||(e={});for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function i(t,s){if(t instanceof i)return t;if(t instanceof HTMLElement&&!(this instanceof i))return new i(t,s);if(!(this instanceof i))return(t=e(t,s instanceof i?s.dom:s))?new i(t):null;s=n(s,{appendTo:null,context:document,html:"",insertAfter:null,insertBefore:null,replace:null});var o,r,l=t instanceof HTMLElement?t:null;if("string"==typeof t){r=function(e,t){return e.match(/(\[[^\]]+\]|#[^#.\[]+|\.[^#.\[]+|\w+)/g).forEach(function(e){"["==e[0]?(e=e.match(/^\[([^=\]]+)=?([^\]]+)?\]$/))&&(t.attribs[e[1]]=e[2]||""):"."==e[0]?t.classes.push(e.substr(1)):"#"==e[0]?t.attribs.id=e.substr(1):t.tag=e}),t}(t,{attribs:{},classes:[]}),l=s.context.createElement(r.tag),r.classes.forEach(function(e){l.classList.add(e)});for(o in r.attribs)r.attribs.hasOwnProperty(o)&&l.setAttribute(o,r.attribs[o])}this.events={},this.dom=t instanceof HTMLElement?t:l,this.parent=t instanceof HTMLElement?i(t.parentElement):null,s.html&&l&&(l.innerHTML=s.html),(o=i(s.replace))?o.parent.replace(this,o):(o=i(s.appendTo))?o.append(this):(o=i(s.insertAfter))?o.parent.append(this,o):(o=i(s.insertBefore))&&o.parent.insert(this,o)}function s(e,t){this._files=[],this._form=null,this._i18n=s.i18n.en_GB,this._parent=i(e),this._status=s.status.READY,this._options=n(t,{accept:"*/*",chunked:!1,chunkSize:1048576,className:"filefunnel",multiple:!1}),this.locale=t.locale||(navigator?(navigator.userLanguage||navigator.language).replace("-","_"):null),this.build()}return i.prototype={add:function(e){return(e instanceof Array?e:[e]).forEach(function(e){(e=i(e))&&(this.dom.appendChild(e.dom),e.parent=this)},this),this},append:function(e,t){return(t=this.child(t))?this.dom.insertBefore(i(e).dom,t.dom.nextElementSibling):this.dom.appendChild(i(e).dom),e instanceof i&&(e.parent=this),this},attrib:function(e,t){if("string"==typeof e){if(void 0===t)return this.dom.getAttribute(e);this.dom.setAttribute(e,t)}return t},child:function(n){if("string"==typeof n){var s,o,r,l,a=this.dom;if(n.split(" ").forEach(function(t,n,i){a&&n<i.length-1&&(a=e(t,a))}),a){o=[].slice.call(a.children),l=t(n,a);for(r in l)for(s in o)if(l[r]===o[s])return i(o[s])}}else{if(n instanceof i)return n.dom.parentElement===this.dom?n:null;if(n instanceof HTMLElement)return n.parentElement===this.dom?i(n):null}return null},get classes(){return this.dom.classList},clear:function(){for(var e,t=this.dom;e=t.firstChild;)t.removeChild(e);return this},get enabled(){return!this.dom.hasAttribute("disabled")},set enabled(e){return e?this.dom.removeAttribute("disabled"):this.dom.setAttribute("disabled",""),this.enabled},focus:function(){this.dom.focus(),this.dom.selectionStart=this.value.length},get html(){return this.dom.innerHTML},set html(e){return this.dom.innerHTML=e},insert:function(e,t){return this.dom.insertBefore(i(e).dom,(t=this.child(t))?t.dom:this.dom.firstElementChild),e instanceof i&&(e.parent=this),this},on:function(e,t,n){return(e instanceof Array?e:[e]).forEach(function(e){if("string"==typeof e){var i=this,s="function"==typeof t?function(e){return t.call(n||i,e)}:null;i.events[e]instanceof Array||(i.events[e]=[]),s?(i.events[e].push(s),i.dom.addEventListener(e,s)):i.events[e].forEach(function(t,n,s){i.dom.removeEventListener(e,t),s.splice(n,1)})}},this),this},remove:function(e){(e=i(e))&&this.dom.removeChild(e.dom)},replace:function(e,t){return(e=new i(e))&&(t=i(t,this))&&(this.dom.replaceChild(e.dom,t.dom),e.parent=this,t.parent=null),this},get value(){return void 0!==this.dom.value?this.dom.value:this.html},set value(e){return void 0!==this.dom.value?this.dom.value=e:this.html=e},get visible(){return!this.dom.hasAttribute("hidden")},set visible(e){return e?this.dom.removeAttribute("hidden"):this.dom.setAttribute("hidden",""),this.visible}},s.VERSION=.2,s.status={READY:0,UPLOADING:1,COMPLETED:3,ABORTED:4,ERROR:5},s.prototype={build:function(){var e=this._files,t=this._i18n,n=this._options,o=this._parent,r="string"==typeof n.accept?n.accept:"*/*",l=(!0===n.multiple?"[multiple]":"",{form:new i("form[enctype=multipart/form-data]."+n.className),browseButton:new i("input[type=button][value="+(n.multiple?t.browseMultiple:t.browse)+"].browse"),fileInput:new i("input[type=file][accept="+r+"][hidden][multiple]"),fileList:new i("div.filelist"),submitButton:new i("input[type=submit][value="+t.upload+"][disabled].submit"),resetButton:new i("input[type=reset][value="+t.reset+"].reset")});if(!0!==n.multiple&&l.fileInput.dom.removeAttribute("multiple"),l.form.add([l.browseButton,l.fileInput,l.fileList,l.submitButton,l.resetButton]),this._form&&this._form.parent)form.parent.replace(this._form=l.form,this._form);else if(o&&o.dom instanceof HTMLInputElement){l.form.visible=!1,o.parent.append(this._form=l.form,o),o.on("click",function(){this.toggle()},this);var a=this;document.addEventListener("click",function(e,t){for(;t=t?t.parentNode:e.target;)if(t==a._form.dom||t==o.dom)return;a.hide()})}else o&&o.append(this._form=l.form);l.browseButton.on("click",function(){l.fileInput.dom.click()}),l.fileInput.on("change",function(n){e.length=0,l.fileList.clear(),l.fileListItems=[],[].slice.call(n.target.files).forEach(function(n){var s=n.size,o=(n.lastModifiedDate,{});s=s>=1073741824?(s/1073741824).toFixed(2)+t.gibiBytes:s>=1048576?(s/1048576).toFixed(2)+t.mebiBytes:s>=1024?(s/1024).toFixed(2)+t.kibiBytes:s+=t.bytes,l.fileList.add(new i("fieldset.fileinfo").append(new i("legend",{html:n.name})).append(o.name=new i("input[type=text][placeholder="+t.fileName+"][value="+n.name+"].name")).append(o.size=new i("input[type=text][placeholder="+t.fileSize+"][value="+s+"][disabled].size")).append(o.type=new i("input[type=text][placeholder="+t.fileType+"][value="+n.type+"][disabled].type")).append(o.prog=new i("progress[value=0].progress")).append(o.info=new i("span.info"))),e.push({elements:o,finished:!1,reference:n,xhr:null})}),l.submitButton.enabled=n.target.files.length}),l.form.on("submit",function(i){function o(n){n.finished=!0;for(var i in e)if(!e[i].finished)return;l.fileInput.enabled=!0,l.resetButton.value=t.reset,r._status=s.status.COMPLETED}var r=this;if(i.preventDefault(),l.fileInput.enabled=l.submitButton.enabled=!1,l.resetButton.value=t.cancel,r._status=s.status.UPLOADING,n.chunked){var a="number"==typeof n.chunkSize?n.chunkSize:1048576;e.forEach(function(e){var i=0,l=e.reference.size,u=e.elements.name.value,f=function(){var c=e.reference.slice(i,Math.min(l,i+a)+1,e.reference.type),d=e.xhr=new XMLHttpRequest;d.upload.onloadstart=function(t){e.elements.prog.attrib("max",l+(t.lengthComputable?t.total:0)),e.elements.prog.value=i},d.upload.onloadend=function(n){e.elements.prog.attrib("max",l),e.elements.prog.value=i+=c.size,l>i?"function"==typeof f?f():o(e):n.total>0&&(e.elements.info.classes.add("success"),e.elements.info.value=t.success,o(e))},d.upload.onprogress=function(t){t.lengthComputable&&(e.elements.prog.value=i+t.loaded)},d.onreadystatechange=function(n){if(n.target.status>=400)switch(r._status=s.status.ERROR,e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),f=null,o(e),n.target.status){case 401:case 403:e.elements.info.value=t.forbidden;break;case 413:e.elements.info.value=t.oversized;break;default:e.elements.info.value=n.target.statusText}},d.onerror=function(){r._status=s.status.ERROR,e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),e.elements.info.value=t.refused,f=null,o(e)},d.open("POST",n.server,!0),d.setRequestHeader("Content-Type",c.type),d.setRequestHeader("X-File-Name",u),d.setRequestHeader("X-File-Size",l),d.send(c)};e.elements.prog.attrib("max",l),f()})}else{var u=e.xhr=new XMLHttpRequest,f=new FormData;u.onreadystatechange=function(n){n.target.status>=200&&n.target.status<300&&e.forEach(function(e){r._status=s.status.COMPLETED,e.elements.prog.attrib("max",n.total||1),e.elements.prog.attrib("value",n.loaded||1),e.elements.info.classes.add("success"),e.elements.info.value=t.success,o(e)})},u.onerror=function(n){e.forEach(function(e){r._status=s.status.ERROR,e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),e.elements.info.value=t.refused,o(e)})},e.forEach(function(e){f.append(e.reference.name,e.reference,e.elements.name.value),e.elements.prog.dom.removeAttribute("value")}),u.open("POST",n.server,!0),u.send(f)}}),l.form.on("reset",function(){l.fileList.clear(),l.fileListItems=[],l.fileInput.enabled=!0,l.submitButton.enabled=!1,l.resetButton.value=t.reset})},hide:function(){this._form&&(this._form.visible=!1)},get locale(){return this._i18n},set locale(e){s.i18n[e]&&s.i18n[e]!==this._i18n&&(this._i18n=s.i18n[e])},show:function(){this._form&&(this._form.visible=!0)},toggle:function(){this._form&&(this._form.visible=!this._form.visible)}},s.i18n={en_GB:{browse:"Choose file",browseMultiple:"Choose files",cancel:"Cancel","delete":"Delete",reset:"Reset",upload:"Upload",bytes:" bytes",gibiBytes:" GiB",kibiBytes:" KiB",mebiBytes:" MiB",fileName:"Filename",fileSize:"Filesize",fileType:"Filetype",forbidden:"Unauthorised for upload",oversized:"File too big for upload",refused:"Connection refused",success:"Upload successful"}},"undefined"!=typeof window&&(window.FileFunnel=s),"object"==typeof module&&module.exports&&(module.exports=s),s}();