!function(){"use strict";function e(e,t){return"string"==typeof e?(t||document).querySelector(e):null}function t(e,t){return[].slice.call((t||document).querySelectorAll(e))}function n(e,t){"object"==typeof e&&e||(e={});for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n]);return e}function i(t,s){if(t instanceof i)return t;if(t instanceof HTMLElement&&!(this instanceof i))return new i(t,s);if(!(this instanceof i))return(t=e(t,s instanceof i?s.dom:s))?new i(t):null;s=n(s,{appendTo:null,context:document,html:"",insertAfter:null,insertBefore:null,replace:null});var o,r,l=t instanceof HTMLElement?t:null;if("string"==typeof t){r=function(e,t){return e.match(/(\[[^\]]+\]|#[^#.\[]+|\.[^#.\[]+|\w+)/g).forEach(function(e){"["==e[0]?(e=e.match(/^\[([^=\]]+)=?([^\]]+)?\]$/))&&(t.attribs[e[1]]=e[2]||""):"."==e[0]?t.classes.push(e.substr(1)):"#"==e[0]?t.attribs.id=e.substr(1):t.tag=e}),t}(t,{attribs:{},classes:[]}),l=s.context.createElement(r.tag),r.classes.forEach(function(e){l.classList.add(e)});for(o in r.attribs)r.attribs.hasOwnProperty(o)&&l.setAttribute(o,r.attribs[o])}this.events={},this.dom=t instanceof HTMLElement?t:l,this.parent=t instanceof HTMLElement?i(t.parentElement):null,s.html&&l&&(l.innerHTML=s.html),(o=i(s.replace))?o.parent.replace(this,o):(o=i(s.appendTo))?o.append(this):(o=i(s.insertAfter))?o.parent.append(this,o):(o=i(s.insertBefore))&&o.parent.insert(this,o)}function s(e,t){this._files=[],this._i18n=s.i18n.en_GB,this._options=n(t,{accept:"*/*",chunked:!1,chunkSize:1048576,className:"filefunnel",multiple:!1}),this.locale=t.locale||(navigator?(navigator.userLanguage||navigator.language).replace("-","_"):null);var o=this._i18n,t=this._options,r=this._files,l="string"==typeof t.accept?t.accept:"*/*",a=!0===t.multiple?"[multiple]":"",u=this.elements={form:new i("form[enctype=multipart/form-data]."+t.className,{appendTo:i(e)}),browseButton:new i("input[type=button][value="+(t.multiple?o.browseMultiple:o.browse)+"].browse"),fileInput:new i("input[type=file][accept="+l+"][hidden]"+a),fileList:new i("div.filelist"),submitButton:new i("input[type=submit][value="+o.upload+"][disabled].submit"),resetButton:new i("input[type=reset][value="+o.reset+"].reset")};u.form.add([u.browseButton,u.fileInput,u.fileList,u.submitButton,u.resetButton]),u.browseButton.on("click",function(){u.fileInput.dom.click()}),u.fileInput.on("change",function(e){r.length=0,u.fileList.clear(),u.fileListItems=[],[].slice.call(e.target.files).forEach(function(e){var t=e.size,n=(e.lastModifiedDate,{});t=t>=1073741824?(t/1073741824).toFixed(2)+o.gibiBytes:t>=1048576?(t/1048576).toFixed(2)+o.mebiBytes:t>=1024?(t/1024).toFixed(2)+o.kibiBytes:t+=o.bytes,u.fileList.add(new i("fieldset.fileinfo").append(new i("legend",{html:e.name})).append(n.name=new i("input[type=text][placeholder="+o.fileName+"][value="+e.name+"].name")).append(n.size=new i("input[type=text][placeholder="+o.fileSize+"][value="+t+"][disabled].size")).append(n.type=new i("input[type=text][placeholder="+o.fileType+"][value="+e.type+"][disabled].type")).append(n.prog=new i("progress[value=0].progress")).append(n.info=new i("span.info"))),r.push({elements:n,finished:!1,reference:e})}),u.submitButton.enabled=e.target.files.length}),u.form.on("submit",function(e){function n(e){e.finished=!0;for(var t in r)if(!r[t].finished)return;u.fileInput.enabled=!0,u.resetButton.value=o.reset}if(e.preventDefault(),u.fileInput.enabled=u.submitButton.enabled=!1,u.resetButton.value=o.cancel,t.chunked){var i="number"==typeof t.chunkSize?t.chunkSize:1048576;r.forEach(function(e){var s=0,r=e.reference.size,l=e.elements.name.value,a=function(){var u=e.reference.slice(s,Math.min(r,s+i)+1,e.reference.type),c=new XMLHttpRequest;c.upload.onloadstart=function(t){e.elements.prog.attrib("max",r+(t.lengthComputable?t.total:0)),e.elements.prog.value=s},c.upload.onloadend=function(){e.elements.prog.attrib("max",r),e.elements.prog.value=s+=u.size,r>s?"function"==typeof a?a():n(e):(e.elements.info.classes.add("success"),e.elements.info.value=o.success,n(e))},c.upload.onprogress=function(t){t.lengthComputable&&(e.elements.prog.value=s+t.loaded)},c.onreadystatechange=function(t){if(t.target.status>=400)switch(e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),a=null,n(e),t.target.status){case 401:case 403:e.elements.info.value=o.forbidden;break;case 413:e.elements.info.value=o.oversized;break;default:e.elements.info.value=t.target.statusText}},c.onerror=function(){e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),e.elements.info.value=o.refused,a=null,n(e)},c.open("POST",t.server,!0),c.setRequestHeader("Content-Type",u.type),c.setRequestHeader("X-File-Name",l),c.setRequestHeader("X-File-Size",r),c.send(u)};e.elements.prog.attrib("max",r),a()})}else{var s=new XMLHttpRequest,l=new FormData;s.onreadystatechange=function(e){e.target.status>=200&&e.target.status<300&&r.forEach(function(t){t.elements.prog.attrib("max",e.total||1),t.elements.prog.attrib("value",e.loaded||1),t.elements.info.classes.add("success"),t.elements.info.value=o.success,n(t)})},s.onerror=function(e){r.forEach(function(e){e.elements.prog.attrib("max",e.elements.prog.value=0),e.elements.info.classes.add("error"),e.elements.info.value=o.refused,n(e)})},r.forEach(function(e){l.append(e.reference.name,e.reference,e.elements.name.value),e.elements.prog.dom.removeAttribute("value")}),s.open("POST",t.server,!0),s.send(l)}}),u.form.on("reset",function(){u.fileList.clear(),u.fileListItems=[],u.fileInput.enabled=!0,u.submitButton.enabled=!1,u.resetButton.value=o.reset})}return i.prototype={add:function(e){return(e instanceof Array?e:[e]).forEach(function(e){(e=i(e))&&(this.dom.appendChild(e.dom),e.parent=this)},this),this},append:function(e,t){return(t=this.child(t))?this.dom.insertBefore(i(e).dom,t.dom.nextElementSibling):this.dom.appendChild(i(e).dom),e instanceof i&&(e.parent=this),this},attrib:function(e,t){if("string"==typeof e){if(void 0===t)return this.dom.getAttribute(e);this.dom.setAttribute(e,t)}return t},child:function(n){if("string"==typeof n){var s,o,r,l,a=this.dom;if(n.split(" ").forEach(function(t,n,i){a&&n<i.length-1&&(a=e(t,a))}),a){o=[].slice.call(a.children),l=t(n,a);for(r in l)for(s in o)if(l[r]===o[s])return i(o[s])}}else{if(n instanceof i)return n.dom.parentElement===this.dom?n:null;if(n instanceof HTMLElement)return n.parentElement===this.dom?i(n):null}return null},get classes(){return this.dom.classList},clear:function(){for(var e,t=this.dom;e=t.firstChild;)t.removeChild(e);return this},get enabled(){return!this.dom.hasAttribute("disabled")},set enabled(e){return e?this.dom.removeAttribute("disabled"):this.dom.setAttribute("disabled",""),this.enabled},focus:function(){this.dom.focus(),this.dom.selectionStart=this.value.length},get html(){return this.dom.innerHTML},set html(e){return this.dom.innerHTML=e},insert:function(e,t){return this.dom.insertBefore(i(e).dom,(t=this.child(t))?t.dom:this.dom.firstElementChild),e instanceof i&&(e.parent=this),this},on:function(e,t,n){return(e instanceof Array?e:[e]).forEach(function(e){if("string"==typeof e){var i=this,s="function"==typeof t?function(e){return t.call(n||i,e)}:null;i.events[e]instanceof Array||(i.events[e]=[]),s?(i.events[e].push(s),i.dom.addEventListener(e,s)):i.events[e].forEach(function(t,n,s){i.dom.removeEventListener(e,t),s.splice(n,1)})}},this),this},remove:function(e){(e=i(e))&&this.dom.removeChild(e.dom)},replace:function(e,t){return(e=new i(e))&&(t=i(t,this))&&(this.dom.replaceChild(e.dom,t.dom),e.parent=this,t.parent=null),this},get value(){return void 0!==this.dom.value?this.dom.value:this.html},set value(e){return void 0!==this.dom.value?this.dom.value=e:this.html=e}},s.VERSION=.14,s.prototype={get locale(){return this._i18n},set locale(e){s.i18n[e]&&s.i18n[e]!==this._i18n&&(this._i18n=s.i18n[e])}},s.i18n={en_GB:{browse:"Choose file",browseMultiple:"Choose files",cancel:"Cancel",reset:"Reset",upload:"Upload",bytes:" bytes",gibiBytes:" GiB",kibiBytes:" KiB",mebiBytes:" MiB",fileName:"Filename",fileSize:"Filesize",fileType:"Filetype",forbidden:"Unauthorised for upload",oversized:"File too big for upload",refused:"Connection refused",success:"Upload successful"}},"undefined"!=typeof window&&(window.FileFunnel=s),"object"==typeof module&&module.exports&&(module.exports=s),s}();